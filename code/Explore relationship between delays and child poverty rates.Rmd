---
title: "Explore relationship between delays and child poverty rates"
author: "Joy Dada"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output: rmdformats::robobook
---

# Introduction

This script performs regressions exploring the relationship between delays to EI services and child poverty rates. This analysis implies no relationship between child poverty rates and delays. Next to explore is the relationship between delays and successful EI; and between county crime rates and delays. Will also add in earlier data to test.

```{r setup, include = FALSE, warning = FALSE, message = FALSE}
knitr::opts_chunk$set(echo = TRUE)

path_box <- 
  file.path(
    Sys.getenv("BOX"),
    "Child Care and Poverty"
  )

require("pacman")

packages <-
  c("tidyverse",
    "ggplot2",
    "readxl",
    "haven",
    "tidyr",
    "openxlsx",
    "remotes",
    "janitor",
    "USpopcenters",
    "tigris",
    "expss",
    "dplyr",
    "statar",
    "leaflet",
    "dataReporter",
    "here",
    "ggeasy",
    "extrafont",
    "sjlabelled",
    "wesanderson",
    "kableExtra",
    "epiDisplay",
    "lfe",
    "stargazer",
    "sf"
  )

pacman::p_load(
  packages,
  character.only = TRUE
)
```


# Import data

```{r}
delay_df <-
  readRDS(
     here(
      path_box,
      "Data",
      "constructed",
      "Delays and Poverty (2014-2017).rds"
    )
  )
```

# Arrange data

```{r}
delay_df <-
  delay_df %>%
  group_by(year) %>% 
  mutate(
    pov_quant = xtile(poverty_under_age_18, 10)
      # pov_quant =
      #   factor(
      #     pov_quant,
      #     levels = 1:5,
      #     labels = c("Q1: Relatively rich", "Q2", "Q3", "Q4", "Q5: Relatively poor")
      #   )
  ) %>% 
  ungroup() %>% 
  mutate(
    across(
      c("year", "cfc", "countyfp"),
      as.factor
    )
  ) %>% 
  group_by(
    cfc 
  ) %>% 
  mutate(
    n_county = factor(n_distinct(name)),
    sum_ifsp = sum(active_ifsp)
  ) %>% 
  ungroup()
```

# Specification

$$Delay_{\text{cfc}, t} = \beta_{0} + \beta_{1}Poverty_{\text{county},t} + \chi_{cfc} + \tau_{t} + \epsilon_{t} $$


Where $\chi_{cfc}$ are CFC fixed effects, $\tau_{t}$ are yearly fixed effects.


```{r, warning = FALSE, message = FALSE}
mod1 <-
  felm(
    pct_no_delays ~ factor(pov_quant) | cfc + year, 
    data = delay_df
  )

stargazer(
  mod1,
  type = "text",
  style = "aer"
)
```
